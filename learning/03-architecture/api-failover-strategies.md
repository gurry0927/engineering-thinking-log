# 高可用性 API 設計：Failover 機制與多 Key 備援策略

## 📌 背景
當系統作為產品化工具（如 P-04 的 LineBot 介面）提供給前線人員使用時，任何 API 報錯或額度耗盡都會導致使用者信任度下降。

## 🏗️ 備援架構設計 (Failover Mechanism)
在 Cloud Run 的後端邏輯中，我們實作了「雙 API Key 負載均衡/備援」：
1. **主 Key (Primary)**：優先使用的 API 密鑰。
2. **備援 Key (Secondary/Fallback)**：當主 Key 失敗時接手。

### 🔄 切換觸發條件
系統偵測到特定 HTTP 錯誤碼時自動觸發切換：
- `405/409`：通常代表 API 限制、衝突或額度超限。
- `429`：過多請求 (Rate Limit)。
- `5xx`：API 供應商暫時性故障。

## 🛡️ 實作要點
- **無縫轉移**：使用者在 Line 端不需要重傳圖片，後端自動重試。
- **權限隔離**：API Key 應儲存於 GCP Secret Manager，而非寫死在代碼中。
- **日誌追蹤**：切換發生時需記錄 Log，以便管理員後續補點或檢查帳號狀態。

## 💡 專業價值
這種設計體現了「產品思維」。一個厲害的工程師不僅能讓系統跑通 (PoC)，還能保證系統在「異常情況」下仍能提供服務，這就是 **穩定性 (Reliability)** 的體現。
