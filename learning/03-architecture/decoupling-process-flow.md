# 解除流程耦合：讓麥當勞式出餐邏輯應對現實混亂

## 📌 案例分析：麥當勞的資料邏輯
麥當勞的系統並不強求「先結帳才能做餐」的死板順序（在很多忙碌分店是平行的），但它一定會記錄：
1. **點餐內容** (Fact)
2. **出餐時間** (Fact)
3. **收費紀錄** (Fact)

## 🛠️ 實作策略：如何設計「可容忍亂序」的流程

### 1. 欄位設計：以事件為核心
不要設計 `current_stage` 欄位，而是設計：
- `quoted_at`
- `confirmed_at`
- `contracted_at`
- `sealed_at`

### 2. 後端推論：動態計算狀態
```javascript
function getStatus(record) {
  if (record.sealed_at) return "已簽署";
  if (record.contracted_at) return "合約處理中";
  if (record.quoted_at) return "已報價";
  return "洽談中";
}
```

### 3. 優點
- **容錯性高**：即使 `quoted_at` 是空的，只要 `sealed_at` 有值，狀態依然能正確顯示為「已簽署」。
- **追蹤性強**：你可以輕易分析「報價到用印平均花了幾天」，因為你存的是時間，不是標籤。

## 💡 總結
資料庫要「撐住」未來的變動，最好的方式就是「不預測流程」。只記錄發生過的事，把判讀的權利留給邏輯。

---
> **結論**：好的架構師，是能在混亂的現實中，建立一條「不怕亂」的資料管線。
