# Firebase/RAG 知識管理系統：架構與決策 (Knowledge System Architecture)

## 🏗️ 系統藍圖：事件驅動的文件攝入 (Event-Driven Ingestion)
為了解決傳統「手動上傳」的摩擦感，設計了一套以 Email 為入口的自動化管線：

1. **攝入通道 (Ingestion Channel)**：指定 Email 信箱作為檔案入口。
2. **規則過濾 (Topic-based Filtering)**：僅處理主旨符合特定規則的信件，降低系統雜訊。
3. **結構化提取 (Regex Extraction)**：利用政府文件高度規整的特性，透過正則表達式自動提取關鍵屬性並重新命名檔案，實現「一眼看穿」的可讀性。
4. **雲端存儲 (Storage Partitioning)**：同步存儲至 Google Drive，確保原始文件的物理備份。

---

## 🔐 權限與身份管理 (Identity & Access Control)
利用 Firebase Auth 建立具備高度彈性的角色訪問控制 (RBAC)：

| 角色 | 權限等級 | 說明 |
| :--- | :--- | :--- |
| **高層管理 (Admin)** | 統籌權 | 可決定低層人員可存取的專案範圍。 |
| **基層人員 (User)** | 查詢權 | 僅能在授權範圍內進行專案內容查詢。 |
| **封存帳號 (Archived)** | 審計權 | 禁止登入，但保留歷史操作記錄，防止「責任鏈斷頭」。 |

---

## 🧠 人機協作設計 (Human-AI Collaboration)

### 1. RAG 知識問答 (Retrieval-Augmented Generation)
- **核心技術**：Vertex AI + Vector Search。
- **設計重點**：不追求通才 AI，而是針對特定專案建立知識邊界，提供精準、有根據的問答服務。
- **歷史記錄**：為每個帳號建立獨立的對話歷史，支持自我追蹤與認知累積。

### 2. AI-First 文件化 (AIGuide.md)
- **概念**：文件不只是給人讀的，更是為了「快速對位 AI」而寫。
- **實踐**：建立 `AIGuide.md`，讓新進同事交接時，能讓 AI 在 60 秒內理解系統全貌並協助引導。

---

## 🛡️ 防禦性決策：封存與錨點 (Defensive Decisions)

### 1. 封存優於刪除 (Archive over Delete)
- **動機**：對抗「資料無用論」。
- **邏輯**：刪除資料會導致「全局掃描」邏輯變複雜（需排除已處理項），且會抹殺歷史責任鏈。
- **結果**：系統邏輯更簡單、更健壯，且具備完整的審計追蹤能力。

### 2. 需求引導錨點 (UI Goal Discovery)
- **設計**：在 UI 上預留「上鎖的功能（Locked Feature）」。
- **邏輯**：不急於實作模糊需求。透過視覺佔位符，引導使用者主動思考並定義真正的功能需求，減少「猜完就打掉」的開發內耗。

---

## 💭 工程反思
- **協同開發的邊界**：清楚定義「核心邏輯 (我)」與「視覺表現 (美感強的同事)」的邊界，避免無效內耗。
- **狀態驅動 UI 的必要性**：體會到複雜事件綁定中，具備「時間序」與「唯一標識」之資料模型的重要性。
