# 客戶資料清洗 2.0：設計思路與三階段模型

## 💡 設計目標
> 只要使用者上傳「結構類似」的資料，就能自動將公司名稱清洗到可用、可驗證的狀態。

本專案的核心挑戰，**並不是單純的字串清洗（string cleaning）**，而是：**如何判斷一段文字中，哪些資訊「應該影響公司身分（identity）」，哪些只是雜訊（noise）或附屬資訊。**

---

## 🏗️ 三階段公司名稱處理模型

### Stage A：結構切割 (Structure-aware Parsing)
此階段**不嘗試理解語意，只處理資料結構**，目標是將混雜在同一欄位中的資訊拆解為可控的組件。

- **處理重點**：分隔符號解析 (`-`, `_`, `:`）、多實體表示 (`/`）、Excel 合併儲存格繼承、以及明顯雜訊移除。
- **核心價值**：避免在尚未釐清結構前，過早進行破壞性清洗。

### Stage B：公司身分正規化 (Company Canonicalization)
此階段的目標是回答：**這些不同寫法，是否指向「同一個實體公司」？**

- **策略**：使用政府登記資料（統編）作為最高可信來源（Canonical Truth）。
- **欄位區分**：
    - `company_raw`: 原始輸入。
    - `company_clean`: 可查詢 API 的版本。
    - `company_key`: 去除法人後綴的比對用 Key（Identity Anchor）。
- **核心價值**：確保公司身分的唯一性，優於單純的字串相似度。

### Stage C：人工回饋與可學習設計 (Human-in-the-loop)
承認機器會犯錯，將人工決策納入系統循環。

- **處理重點**：記錄人工確認結果（`review_status`），反饋至規則層以優化模糊比對門檻。
- **核心價值**：讓系統隨資料量增加而「變得更穩定」，而非更脆弱。

---

## 🚀 未來藍圖 (Roadmap)

### V3：聯絡人歸屬 (Contacts)
- **重點**：不強行去重人名，而是強化「聯絡人與公司的歸屬關係」。
- **策略**：建立 `contact_id` 與 `company_id` 的對應，允許同公司下存在多位聯絡人。

### V4：隱私資料格式化 (Privacy & Contact Detail)
- **重點**：電話、Email 的 Regex 驗證與格式化。
- **策略**：利用 Email Domain 與公司 Identity 進行關聯驗證。

---
> [!IMPORTANT]
> **設計原則**：先拆結構，再談清洗；身分識別優於字串相似；人工決策是系統的一部分。
